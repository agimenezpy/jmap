<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE Map [
 <!ENTITY dbparams SYSTEM "./postgis-params.en" >
 <!ENTITY leisure SYSTEM "./osm_adds.xml" >
 <!ENTITY calle SYSTEM "./calle.xml" >
 <!ENTITY calle_lbl SYSTEM "./calle_lbl.xml" >
 <!ENTITY base SYSTEM "./base.xml" >
 <!ENTITY limites SYSTEM "./limites.xml" >
]>
<Map bgcolor="#f2efe9" srs="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs +over">
    &calle;
    &calle_lbl;
    &base;
    &limites;
    &leisure;
    
    <Layer name="rio" status="on" srs="+proj=utm +datum=WGS84 +zone=21 +south">
        <StyleName>agua</StyleName>
        <Datasource>
            <Parameter name="type">shape</Parameter>
            <Parameter name="file">/home/agimenez/Desktop/mapas/shapefiles/nuevos/riop</Parameter>
        </Datasource>
    </Layer>

    <Layer name="ciudad" status="on" srs="+proj=utm +datum=WGS84 +zone=21 +south">
        <StyleName>ciudad</StyleName>
        <Datasource>
            &dbparams;
            <Parameter name="table">ciudad</Parameter>
        </Datasource>
    </Layer>

    <Layer name="zona" status="on" srs="+proj=utm +datum=WGS84 +zone=21 +south">
        <StyleName>zona</StyleName>
        <Datasource>
            &dbparams;
            <Parameter name="table">zona</Parameter>
        </Datasource>
    </Layer>

    <Layer name="leisure" status="on" srs="+proj=utm +datum=WGS84 +zone=21 +south">
        <StyleName>leisure</StyleName>
        <Datasource>
          &dbparams;
          <Parameter name="table">
          (select o.fid,o.name,o.the_geom,aeroway,amenity,building,highway,landuse,leisure,man_made,military,"natural",power,tourism,railway from area_interes_old as o,
            xpath_table('fid', 'attrs', 'area_interes_old',
            '/attrs/aeroway|/attrs/amenity|/attrs/building|/attrs/highway|/attrs/landuse|/attrs/leisure|/attrs/man_made|/attrs/military|/attrs/natural|/attrs/power|/attrs/tourism|/attrs/railway', 'true') as 
            t(fid int, aeroway varchar,amenity varchar,building varchar,highway varchar,landuse varchar,leisure varchar,man_made varchar,military varchar,"natural" varchar,power varchar,tourism varchar, railway varchar)
            where o.fid = t.fid
            order by o.z_order,area(o.the_geom) desc) as leisure
          </Parameter>
        </Datasource>
      </Layer>

    <Layer name="base" status="on" srs="+proj=utm +datum=WGS84 +zone=21 +south">
        <StyleName>base</StyleName>
        <StyleName>calle</StyleName>
        <Datasource>
            &dbparams;
            <Parameter name="table">(select * from calle order by zorder, prioridad, id) as street</Parameter>
        </Datasource>
    </Layer>
    
    <!--Layer name="calle" status="on" srs="+proj=utm +datum=WGS84 +zone=21 +south">
        <StyleName>calle</StyleName>
        <Datasource>
            &dbparams;
            <Parameter name="table">(select * from callemulti order by zorder, prioridad, id) as street</Parameter>
        </Datasource>
    </Layer-->
    
    <Layer name="barrio" status="on" srs="+proj=utm +datum=WGS84 +zone=21 +south">
        <StyleName>barrio</StyleName>
        <Datasource>
            &dbparams;
            <Parameter name="table">barrio</Parameter>
        </Datasource>
    </Layer>

    <Layer name="calle_lbl" status="on" srs="+proj=utm +datum=WGS84 +zone=21 +south">
        <StyleName>direcciones</StyleName>
        <StyleName>calle_lbl</StyleName>
        <Datasource>
            &dbparams;
            <Parameter name="table">(select * from callemulti order by zorder desc, prioridad, id) as street</Parameter>
        </Datasource>
    </Layer>
    
    <Layer name="amenity" status="on" srs="+proj=utm +datum=WGS84 +zone=21 +south" clear_label_cache='true'>
        <StyleName>stations</StyleName>
        <StyleName>amenity</StyleName>
        <Datasource>
          &dbparams;
          <Parameter name="table">
            (select o.fid,o.name,o.the_geom,aeroway,amenity,highway,man_made,"natural",power,railway,religion from punto_interes_old as o,
            xpath_table('fid', 'attrs', 'punto_interes_old',
            '/attrs/aeroway|/attrs/amenity|/attrs/highway|/attrs/man_made|/attrs/natural|/attrs/power|/attrs/railway|/attrs/religion', 'true') as 
            t(fid int, aeroway varchar,amenity varchar,highway varchar,man_made varchar,"natural" varchar,power varchar,railway varchar,religion varchar)
            where o.fid = t.fid and (amenity IS NOT NULL or railway is NOT NULL or "natural" is NOT NULL or man_made is NOT NULL or highway is NOT NULL or aeroway is NOT NULL or power is NOT NULL)
            order by o.z_order desc) as amenity
          </Parameter>
        </Datasource>
   </Layer>
    
    <Layer name="area-text" status="on" srs="+proj=utm +datum=WGS84 +zone=21 +south" clear_label_cache='true'>
        <StyleName>area-text</StyleName>
        <Datasource>
            &dbparams;
            <Parameter name="table">
                (select name, xpath_string(attrs, '/attrs/military') as military, area(the_geom) as way_area, the_geom from area_interes_old where name is not null order by z_order,area(the_geom) desc) as leisure
            </Parameter>
        </Datasource>
    </Layer>
    
    <Layer name="text" status="on" srs="+proj=utm +datum=WGS84 +zone=21 +south" clear_label_cache='true'>
        <StyleName>text</StyleName>
        <Datasource>
          &dbparams;
          <Parameter name="table">
            (select o.name,o.the_geom,place,amenity,leisure,landuse,"natural",tourism,highway,ref
            from punto_interes_old as o,
                xpath_table('fid', 'attrs', 'punto_interes_old',
                    '/attrs/place|/attrs/amenity|/attrs/leisure|/attrs/landuse|/attrs/natural|/attrs/tourism|/attrs/highway|/attrs/ref', 'true') as 
                   t(fid int, place varchar, amenity varchar, leisure varchar, landuse varchar, "natural" varchar, tourism varchar, highway varchar, ref varchar)
            where o.fid = t.fid and o.name is not null
           ) as places
          </Parameter>
        </Datasource>
   </Layer>
    
    <Layer name="poly_lbl" status="on" srs="+proj=utm +datum=WGS84 +zone=21 +south" clear_label_cache='true' >
        <StyleName>poly_lbl</StyleName>
        <Datasource>
            &dbparams;
            <Parameter name="table">poly_lbl</Parameter>
        </Datasource>
    </Layer>
</Map>
